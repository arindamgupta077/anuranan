<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1B4B8F">
    <title>Course Management - Admin Panel</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Additional styles specific to course management */
        .course-form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(27, 75, 143, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .features-list {
            list-style: none;
            padding: 0;
        }

        .feature-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .feature-item input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .btn-remove-feature {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-remove-feature:hover {
            background: #c82333;
        }

        .btn-add-feature {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .btn-add-feature:hover {
            background: var(--dark-blue);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn-submit {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-submit:hover {
            background: var(--dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(27, 75, 143, 0.3);
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .courses-list {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .course-item {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .course-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .course-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .course-item-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .course-item-title h3 {
            margin: 0;
            color: var(--primary-blue);
        }

        .course-badge {
            background: var(--primary-yellow);
            color: var(--primary-blue);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .course-badge.new {
            background: #28a745;
            color: white;
        }

        .course-badge.discount {
            background: #dc3545;
            color: white;
        }

        .course-item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit,
        .btn-delete,
        .btn-toggle {
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: var(--primary-blue);
            color: white;
        }

        .btn-edit:hover {
            background: var(--dark-blue);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .btn-toggle {
            background: #28a745;
            color: white;
        }

        .btn-toggle.inactive {
            background: #ffc107;
        }

        .btn-toggle:hover {
            opacity: 0.9;
        }

        .course-item-description {
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .course-features-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .course-features-display li {
            color: var(--text-dark);
            font-size: 14px;
        }

        .course-features-display i {
            color: var(--primary-blue);
            margin-right: 8px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .icon-preview {
            font-size: 32px;
            color: var(--primary-blue);
            margin-top: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 22px;
            color: white;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 28px;
            color: white;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .btn-add-course {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-add-course:hover {
            background: var(--dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(27, 75, 143, 0.3);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .course-item-header {
                flex-direction: column;
                gap: 15px;
            }

            .course-item-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .modal-content {
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
            }

            .modal-header {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Navigation -->
    <nav class="admin-navbar">
        <div class="admin-nav-content">
            <div class="admin-logo">
                <div class="logo-icon">অ</div>
                <div class="logo-text">
                    <h1>অনুরণন</h1>
                    <p>Course Management</p>
                </div>
            </div>
            <div class="admin-actions">
                <a href="index.html" class="btn-view-site">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="admin-dashboard" style="margin-top: 100px; padding: 30px;">
        <div class="container" style="max-width: 1400px; margin: 0 auto;">
            
            <!-- Page Header -->
            <div class="section-header" style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h2 style="color: var(--primary-blue); font-size: 28px; margin-bottom: 10px;">
                        <i class="fas fa-book"></i> Course Management
                    </h2>
                    <p style="color: var(--text-light); margin: 0;">Add, edit, or remove courses from your website</p>
                </div>
                <button class="btn-add-course" id="openCourseModalBtn">
                    <i class="fas fa-plus-circle"></i> Add New Course
                </button>
            </div>

            <!-- Courses List -->
            <div class="courses-list">
                <h3 style="color: var(--primary-blue); margin-bottom: 25px;">
                    <i class="fas fa-list"></i> All Courses
                </h3>
                <div id="coursesContainer">
                    <div style="text-align: center; padding: 40px; color: var(--text-light);">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px;"></i>
                        <p style="margin-top: 15px;">Loading courses...</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Course Form Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">
                    <i class="fas fa-plus-circle"></i> Add New Course
                </h3>
                <button class="modal-close" id="closeCourseModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="courseForm">
                    <input type="hidden" id="courseId" value="">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="courseTitle">
                                <i class="fas fa-heading"></i> Course Title *
                            </label>
                            <input type="text" id="courseTitle" required placeholder="e.g., Bengali Recitation">
                        </div>
                        
                        <div class="form-group">
                            <label for="courseIcon">
                                <i class="fas fa-icons"></i> Icon Class *
                            </label>
                            <input type="text" id="courseIcon" required placeholder="e.g., fas fa-book-open">
                            <div class="icon-preview" id="iconPreview"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="courseDescription">
                                <i class="fas fa-align-left"></i> Description *
                            </label>
                            <textarea id="courseDescription" required placeholder="Enter course description..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="courseBadge">
                                <i class="fas fa-tag"></i> Badge Text (Optional)
                            </label>
                            <input type="text" id="courseBadge" placeholder="e.g., Popular, New, Save 30%">
                        </div>
                        
                        <div class="form-group">
                            <label for="badgeType">
                                <i class="fas fa-palette"></i> Badge Type
                            </label>
                            <select id="badgeType">
                                <option value="popular">Popular (Yellow)</option>
                                <option value="new">New (Green)</option>
                                <option value="discount">Discount (Red)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="buttonText">
                                <i class="fas fa-mouse-pointer"></i> Button Text
                            </label>
                            <input type="text" id="buttonText" placeholder="e.g., Enroll Now" value="Enroll Now">
                        </div>
                        
                        <div class="form-group">
                            <label for="displayOrder">
                                <i class="fas fa-sort-numeric-down"></i> Display Order
                            </label>
                            <input type="number" id="displayOrder" value="0" min="0">
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>
                            <i class="fas fa-list-check"></i> Course Features *
                        </label>
                        <ul class="features-list" id="featuresList">
                            <li class="feature-item">
                                <input type="text" class="feature-input" placeholder="Enter a feature..." required>
                                <button type="button" class="btn-remove-feature" onclick="removeFeature(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                        </ul>
                        <button type="button" class="btn-add-feature" onclick="addFeature()">
                            <i class="fas fa-plus"></i> Add Feature
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="isFeatured">
                                <label for="isFeatured" style="margin: 0;">
                                    <i class="fas fa-star"></i> Mark as Featured Course
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="featuredText">
                                <i class="fas fa-award"></i> Featured Badge Text
                            </label>
                            <input type="text" id="featuredText" placeholder="e.g., Special Offer">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="isActive" checked>
                                <label for="isActive" style="margin: 0;">
                                    <i class="fas fa-eye"></i> Active (Visible on website)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-save"></i> <span id="submitBtnText">Save Course</span>
                        </button>
                        <button type="button" class="btn-cancel" id="cancelFormBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Load Supabase client -->
    <script src="supabase-loader.js"></script>
    
    <!-- Course Management Script -->
    <script>
        let editingCourseId = null;

        // Modal functions
        function openCourseModal() {
            document.getElementById('courseModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCourseModal() {
            document.getElementById('courseModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            resetForm();
        }

        // Modal event listeners
        document.getElementById('openCourseModalBtn').addEventListener('click', openCourseModal);
        document.getElementById('closeCourseModalBtn').addEventListener('click', closeCourseModal);
        document.getElementById('cancelFormBtn').addEventListener('click', closeCourseModal);

        // Close modal when clicking outside
        document.getElementById('courseModal').addEventListener('click', (e) => {
            if (e.target.id === 'courseModal') {
                closeCourseModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('courseModal').classList.contains('active')) {
                closeCourseModal();
            }
        });

        // Check authentication
        async function checkAuth() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (!session) {
                window.location.href = 'index.html';
            }
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await supabaseClient.auth.signOut();
            window.location.href = 'index.html';
        });

        // Icon preview
        document.getElementById('courseIcon').addEventListener('input', (e) => {
            const preview = document.getElementById('iconPreview');
            preview.innerHTML = `<i class="${e.target.value}"></i>`;
        });

        // Add feature
        function addFeature() {
            const featuresList = document.getElementById('featuresList');
            const newFeature = document.createElement('li');
            newFeature.className = 'feature-item';
            newFeature.innerHTML = `
                <input type="text" class="feature-input" placeholder="Enter a feature..." required>
                <button type="button" class="btn-remove-feature" onclick="removeFeature(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            featuresList.appendChild(newFeature);
        }

        // Remove feature
        function removeFeature(btn) {
            const featuresList = document.getElementById('featuresList');
            if (featuresList.children.length > 1) {
                btn.parentElement.remove();
            } else {
                alert('At least one feature is required!');
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('courseForm').reset();
            document.getElementById('courseId').value = '';
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Add New Course';
            document.getElementById('submitBtnText').textContent = 'Save Course';
            document.getElementById('iconPreview').innerHTML = '';
            editingCourseId = null;
            
            // Reset features list
            const featuresList = document.getElementById('featuresList');
            featuresList.innerHTML = `
                <li class="feature-item">
                    <input type="text" class="feature-input" placeholder="Enter a feature..." required>
                    <button type="button" class="btn-remove-feature" onclick="removeFeature(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </li>
            `;
        }

        // Load courses
        async function loadCourses() {
            try {
                const { data: courses, error } = await supabaseClient
                    .from('courses')
                    .select('*')
                    .order('display_order', { ascending: true });

                if (error) throw error;

                displayCourses(courses);
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('coursesContainer').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px;"></i>
                        <p style="margin-top: 15px;">Error loading courses. Please try again.</p>
                    </div>
                `;
            }
        }

        // Display courses
        function displayCourses(courses) {
            const container = document.getElementById('coursesContainer');
            
            if (!courses || courses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-light);">
                        <i class="fas fa-inbox" style="font-size: 32px;"></i>
                        <p style="margin-top: 15px;">No courses found. Add your first course above!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = courses.map(course => {
                const features = Array.isArray(course.features) ? course.features : [];
                const badgeHtml = course.badge ? 
                    `<span class="course-badge ${course.badge_type || 'popular'}">${course.badge}</span>` : '';
                const featuredBadge = course.is_featured ? 
                    `<span class="course-badge" style="background: #e74c3c; color: white;">Featured</span>` : '';
                
                return `
                    <div class="course-item">
                        <div class="course-item-header">
                            <div class="course-item-title">
                                <i class="${course.icon}" style="font-size: 24px; color: var(--primary-blue);"></i>
                                <div>
                                    <h3>${course.title}</h3>
                                    <div style="display: flex; gap: 8px; margin-top: 5px;">
                                        ${badgeHtml}
                                        ${featuredBadge}
                                        <span class="course-badge ${course.is_active ? '' : 'inactive'}" 
                                              style="background: ${course.is_active ? '#28a745' : '#ffc107'};">
                                            ${course.is_active ? 'Active' : 'Inactive'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="course-item-actions">
                                <button class="btn-edit" onclick="editCourse('${course.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-toggle ${course.is_active ? '' : 'inactive'}" 
                                        onclick="toggleCourse('${course.id}', ${!course.is_active})">
                                    <i class="fas fa-${course.is_active ? 'eye-slash' : 'eye'}"></i> 
                                    ${course.is_active ? 'Hide' : 'Show'}
                                </button>
                                <button class="btn-delete" onclick="deleteCourse('${course.id}', '${course.title}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        <p class="course-item-description">${course.description}</p>
                        <ul class="course-features-display">
                            ${features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('')}
                        </ul>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); 
                                    font-size: 12px; color: var(--text-light);">
                            Order: ${course.display_order} | Button: "${course.button_text || 'Enroll Now'}"
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Submit form
        document.getElementById('courseForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Collect features
            const featureInputs = document.querySelectorAll('.feature-input');
            const features = Array.from(featureInputs)
                .map(input => input.value.trim())
                .filter(value => value !== '');

            if (features.length === 0) {
                alert('Please add at least one feature!');
                return;
            }

            const courseData = {
                title: document.getElementById('courseTitle').value.trim(),
                description: document.getElementById('courseDescription').value.trim(),
                icon: document.getElementById('courseIcon').value.trim(),
                badge: document.getElementById('courseBadge').value.trim() || null,
                badge_type: document.getElementById('badgeType').value,
                features: features,
                is_featured: document.getElementById('isFeatured').checked,
                featured_text: document.getElementById('featuredText').value.trim() || null,
                button_text: document.getElementById('buttonText').value.trim() || 'Enroll Now',
                display_order: parseInt(document.getElementById('displayOrder').value) || 0,
                is_active: document.getElementById('isActive').checked
            };

            try {
                const courseId = document.getElementById('courseId').value;
                let result;

                if (courseId) {
                    // Update existing course
                    result = await supabaseClient
                        .from('courses')
                        .update(courseData)
                        .eq('id', courseId);
                } else {
                    // Insert new course
                    result = await supabaseClient
                        .from('courses')
                        .insert([courseData]);
                }

                if (result.error) throw result.error;

                alert(courseId ? 'Course updated successfully!' : 'Course added successfully!');
                closeCourseModal();
                loadCourses();
            } catch (error) {
                console.error('Error saving course:', error);
                alert('Error saving course: ' + error.message);
            }
        });

        // Edit course
        async function editCourse(courseId) {
            try {
                const { data: course, error } = await supabaseClient
                    .from('courses')
                    .select('*')
                    .eq('id', courseId)
                    .single();

                if (error) throw error;

                // Populate form
                document.getElementById('courseId').value = course.id;
                document.getElementById('courseTitle').value = course.title;
                document.getElementById('courseDescription').value = course.description;
                document.getElementById('courseIcon').value = course.icon;
                document.getElementById('courseBadge').value = course.badge || '';
                document.getElementById('badgeType').value = course.badge_type || 'popular';
                document.getElementById('buttonText').value = course.button_text || 'Enroll Now';
                document.getElementById('displayOrder').value = course.display_order || 0;
                document.getElementById('isFeatured').checked = course.is_featured || false;
                document.getElementById('featuredText').value = course.featured_text || '';
                document.getElementById('isActive').checked = course.is_active;

                // Update icon preview
                document.getElementById('iconPreview').innerHTML = `<i class="${course.icon}"></i>`;

                // Populate features
                const featuresList = document.getElementById('featuresList');
                const features = Array.isArray(course.features) ? course.features : [];
                featuresList.innerHTML = features.map(feature => `
                    <li class="feature-item">
                        <input type="text" class="feature-input" value="${feature}" required>
                        <button type="button" class="btn-remove-feature" onclick="removeFeature(this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </li>
                `).join('');

                // Update modal title
                document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Course';
                document.getElementById('submitBtnText').textContent = 'Update Course';

                // Open modal
                openCourseModal();
            } catch (error) {
                console.error('Error loading course:', error);
                alert('Error loading course details');
            }
        }

        // Toggle course active status
        async function toggleCourse(courseId, newStatus) {
            try {
                const { error } = await supabaseClient
                    .from('courses')
                    .update({ is_active: newStatus })
                    .eq('id', courseId);

                if (error) throw error;

                loadCourses();
            } catch (error) {
                console.error('Error toggling course:', error);
                alert('Error updating course status');
            }
        }

        // Delete course
        async function deleteCourse(courseId, courseTitle) {
            if (!confirm(`Are you sure you want to delete "${courseTitle}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('courses')
                    .delete()
                    .eq('id', courseId);

                if (error) throw error;

                alert('Course deleted successfully!');
                loadCourses();
            } catch (error) {
                console.error('Error deleting course:', error);
                alert('Error deleting course: ' + error.message);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadCourses();
        });
    </script>
</body>
</html>
